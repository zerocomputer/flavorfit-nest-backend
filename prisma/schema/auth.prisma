// ============================================================================
// МОДУЛЬ: Аутентификация и Управление Пользователями
// ============================================================================
// Сущности: Роли, Пользователь, Пол, Профиль, Социальные сети, Способы оплаты

model Gender {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]

  createdAt DateTime @default(now())

  @@map("genders")
}

enum UserRole {
  ADMIN
  USER
  COURIER
  SUPPORT
}

model User {
  id              String    @id @default(cuid())
  email           String    @unique
  role            UserRole  @default(USER)
  firstName       String
  lastName        String
  phoneNumber     String?
  passwordHash    String
  birthDate       DateTime?
  biography       String?
  profilePhotoUrl String?
  genderId        Int?
  gender          Gender?   @relation(fields: [genderId], references: [id], onDelete: SetNull)

  // Relations
  profile        Profile?
  socialLinks    SocialLink[]
  paymentMethods PaymentMethod[]

  // Recipes & Comments
  createdRecipes Recipe[]        @relation("RecipeAuthor")
  recipeComments RecipeComment[]
  recipeViews    RecipeView[]
  recipeLikes    RecipeLike[]    @relation("UserRecipeLike")
  commentLikes   CommentLike[]

  // Orders
  orders        Order[]
  courierOrders Order[] @relation("Courier")

  // Tasks
  tasks Task[]

  // Notifications
  receivedNotifications Notification[] @relation("NotificationRecipient")
  sentNotifications     Notification[] @relation("NotificationSender")

  // Forum
  forumTopics        ForumTopic[]
  forumMessages      ForumMessage[]
  forumSubscriptions ForumSubscription[]
  forumMessageLikes  ForumMessageLike[]

  createdAt    DateTime @default(now())
  registeredAt DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("users")
}

model Profile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  height             Float?
  currentWeight      Float?
  targetWeight       Float?
  waistCircumference Float?
  chestCircumference Float?
  hipsCircumference  Float?
  armCircumference   Float?

  nutritionGoalId Int?
  nutritionGoal   NutritionGoal? @relation(fields: [nutritionGoalId], references: [id], onDelete: SetNull)

  activityLevelId Int?
  activityLevel   ActivityLevel? @relation(fields: [activityLevelId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("profiles")
}

model NutritionGoal {
  id       Int       @id @default(autoincrement())
  text     String
  profiles Profile[]

  createdAt DateTime @default(now())

  @@map("nutrition_goals")
}

model ActivityLevel {
  id       Int       @id @default(autoincrement())
  text     String
  profiles Profile[]

  createdAt DateTime @default(now())

  @@map("activity_levels")
}

model SocialLink {
  id     Int    @id @default(autoincrement())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  url    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("social_links")
}

model PaymentMethod {
  id          String @id @default(cuid())
  userId      String
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  type        String // 'card' | 'sbp'
  paymentData Json // Encrypted data, not shown to user

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payment_methods")
}

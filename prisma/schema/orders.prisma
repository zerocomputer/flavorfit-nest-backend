// ============================================================================
// МОДУЛЬ: Заказы
// ============================================================================
// Сущности: Заказы, РецептыКЗаказу, ИнгредиентыКЗаказу

enum OrderStatus {
  PREPARING   // готовится
  DELIVERING  // доставляется
  COMPLETED   // завершен
  CANCELLED   // отменен
}

model Order {
  id                      Int                 @id @default(autoincrement())
  customerId              Int
  customer                User                @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  address                 String
  deliveryPrice           Float
  status                  OrderStatus         @default(PREPARING)
  deliveryTime            DateTime?
  
  courierId               Int?
  courier                 User?               @relation("Courier", fields: [courierId], references: [id], onDelete: SetNull)
  
  // Relations
  recipes                 OrderRecipe[]
  ingredients             OrderIngredient[]

  createdAt               DateTime            @default(now())
  completedAt             DateTime?

  @@map("orders")
}

model OrderRecipe {
  id                      Int       @id @default(autoincrement())
  orderId                 Int
  order                   Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  recipeId                Int
  recipe                  Recipe    @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  
  portions                Int
  pricePerPortion         Float

  @@unique([orderId, recipeId])
  @@map("order_recipes")
}

model OrderIngredient {
  id                      Int       @id @default(autoincrement())
  orderId                 Int
  order                   Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  ingredientId            Int
  ingredient              Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)
  
  quantity                Float
  pricePerUnit            Float

  @@unique([orderId, ingredientId])
  @@map("order_ingredients")
}
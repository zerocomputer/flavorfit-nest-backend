// ============================================================================
// МОДУЛЬ: Уведомления
// ============================================================================
// Сущности: Уведомления

enum NotificationType {
  ORDER       // заказ
  SUBSCRIPTION // подписка
  LIKE        // лайк
  COMMENT     // комментарий
  FORUM_MESSAGE // сообщение в теме на форуме
}

model Notification {
  id                      Int       @id @default(autoincrement())
  type                    NotificationType
  
  recipientId             Int
  recipient               User      @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: Cascade)
  
  senderId                Int
  sender                  User      @relation("NotificationSender", fields: [senderId], references: [id], onDelete: Cascade)
  
  // JSON контекст в зависимости от типа:
  // ORDER: { orderId, orderStatus }
  // SUBSCRIPTION: { topicId }
  // LIKE: { recipeId } или { commentId } или { forumMessageId }
  // COMMENT: { recipeId, commentId }
  // FORUM_MESSAGE: { topicId, messageId }
  context                 Json
  
  isRead                  Boolean   @default(false)
  interactedAt            DateTime? // дата взаимодействия (переход по уведомлению)

  createdAt               DateTime  @default(now())

  @@index([recipientId, isRead])
  @@map("notifications")
}
enum Difficulty {
  LOW
  MEDIUM
  HIGH
}

enum Unit {
  CM
  ML
  GRAM
  UNITS
}

model Recipe {
  id String @id @unique @default(cuid())

  // Автор
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Осн. информация
  name        String
  description String
  categoryId  String         @map("category_id")
  category    RecipeCategory @relation(fields: [categoryId], references: [id])

  // Пищевая ценность 
  carbohydrates Int
  protein       Int
  fat           Int
  fiber         Int
  kcal          Int
  weight        Float

  // Для заказа готового блюда
  price            Float
  minUnitsForOrder Int   @map("min_units_for_order")
  maxUnitsForOrder Int   @map("max_units_for_order")
  cookingTime      Int   @map("cooking_time")

  difficulty Difficulty

  // Временные метки 
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  // Отношения
  steps                RecipeStep[]
  images               RecipeImage[]
  comments             RecipeComment[]
  recipeOrCommentLikes RecipeOrCommentLikes[]
  recipeIngredients    RecipeIngredient[]
  recipeViews          RecipeView[]

  @@map("recipes")
}

model RecipeCategory {
  id String @id @unique @default(cuid())

  // Основная информация
  name String
  icon String?

  // Родительская категория
  parentId String?         @map("parent_id")
  parent   RecipeCategory? @relation("CategoryToParent", fields: [parentId], references: [id])

  // Подкатегории
  children RecipeCategory[] @relation("CategoryToParent")
  recipes  Recipe[]

  @@map("recipe_categories")
}

model RecipeImage {
  id String @id @unique @default(cuid())

  // Рецепт
  receptId String
  recept   Recipe @relation(fields: [receptId], references: [id], onDelete: Cascade)

  // Ссылка на изображение
  imageUrl String @map("image_url")

  // Временные метки 
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("recipe_images")
}

model RecipeStep {
  id String @id @unique @default(cuid())

  // Рецепт
  receptId String
  recept   Recipe @relation(fields: [receptId], references: [id], onDelete: Cascade)

  // Номер по порядку непосредственно внутри рецепта
  index Int

  // Основная информация
  name        String
  description String
  imageUrl    String @map("image_url")

  // Временные метки 
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("recipe_steps")
}

model RecipeComment {
  id String @id @unique @default(cuid())

  // Автор
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Основная информация
  text String

  // Временные метки 
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  // Отношения
  recipe               Recipe?                @relation(fields: [recipeId], references: [id])
  recipeId             String?                @map("recipe_id")
  recipeOrCommentLikes RecipeOrCommentLikes[]

  @@map("recipe_comments")
}

model RecipeOrCommentLikes {
  id String @id @unique @default(cuid())

  // Автор
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // К чему относится
  recipeId        String?        @map("recipe_id")
  recipe          Recipe?        @relation(fields: [recipeId], references: [id])
  recipeCommentId String?        @map("recipe_comment_id")
  recipeComment   RecipeComment? @relation(fields: [recipeCommentId], references: [id])

  // Временные метки 
  createdAt DateTime  @default(now()) @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("recipe_or_comment_likes")
}

model RecipeView {
  id String @id @unique @default(cuid())

  // Автор
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Рецепт
  receptId String @map("recept_id")
  recept   Recipe @relation(fields: [receptId], references: [id], onDelete: Cascade)

  // Временные метки 
  createdAt DateTime @default(now()) @map("created_at")

  @@map("recipe_views")
}

model Ingredient {
  id String @id @unique @default(cuid())

  // Основная информация
  icon        String
  name        String
  description String
  unit        Unit

  // Для заказа
  price            Float
  minUnitsForOrder Int   @map("min_units_for_order")
  maxUnitsForOrder Int   @map("max_units_for_order")

  // Временные метки 
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  endingAt  DateTime? @map("ending_at")
  deletedAt DateTime? @map("deleted_at")

  // Отношения
  recipeIngredients RecipeIngredient[]

  @@unique([name, deletedAt])
  @@map("ingredients")
}

model RecipeIngredient {
  id String @id @unique @default(cuid())

  // Рецепт
  receptId String @map("recept_id")
  recept   Recipe @relation(fields: [receptId], references: [id], onDelete: Cascade)

  // Ингредиент
  ingredientId String     @map("ingredient_id")
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)

  units Float

  @@map("recipe_ingredients")
}
